import{_ as Q,r as p,b as W,d as C,e as m,f as t,m as X,J as Y,u as Z,o as n,h as w,g as s,a as o,t as d,v as S,p as a,n as I,i as ee,V as P,K as A,H as te,l as V,x as se,c as $,k as re,F as B,q as j,A as f,z as F,L as ae,M as oe,N as le,O as ue}from"./index-B4YrDoW6.js";const ne={class:"text-h5 font-weight-bold"},de={class:"mb-3 text-body-1"},ie={class:"d-flex align-center mb-2"},ce={class:"d-flex align-center"},pe={class:"text-h6 white--text"},ve={class:"text-subtitle-1 font-weight-bold"},me={class:"mb-3"},fe={class:"mt-2 d-flex flex-wrap gap-2"},ge={key:1,class:"text-center mt-10"},ye={__name:"OrderDetails",setup(ke){const k=Y(),i=Z(),u=p(null),N=p([]),g=p(null),L=p(!0),U=p(null),v=p(null),b=p(!1),x=p({show:!1,text:"",color:"success"}),T=(l,e="success")=>{x.value={show:!0,text:l,color:e}},c=p("");W(()=>{if(c.value=localStorage.getItem("token")||"",!c.value){i.push("/login");return}M()});const M=async()=>{var l,e,r,z,D,R;try{const y=k.params.id,[O,G]=await Promise.all([C.get(`/api/orders/${y}/full`,{headers:{Authorization:`Bearer ${c.value}`}}),C.get("/api/profile",{headers:{Authorization:`Bearer ${c.value}`}})]);if(u.value=((l=O.data)==null?void 0:l.order)||null,N.value=((e=O.data)==null?void 0:e.stacks)||[],g.value=G.data||null,((r=u.value)==null?void 0:r.ord_status)==="Завершен")try{const _=await C.get(`/api/orders/${y}/approved-contractor`,{headers:{Authorization:`Bearer ${c.value}`}});v.value=_.data}catch(_){console.error("Ошибка при загрузке утвержденного исполнителя:",_)}}catch(y){U.value=((D=(z=y.response)==null?void 0:z.data)==null?void 0:D.message)||y.message,console.error("Ошибка:",y),((R=y.response)==null?void 0:R.status)===401&&i.push("/login")}finally{L.value=!1}},h=async()=>{var l,e;try{if(!c.value){i.push("/login");return}(await C.post(`/api/orders/${k.params.id}/respond`,{},{headers:{Authorization:`Bearer ${c.value}`,"Content-Type":"application/json"}})).status===200&&(alert("Отклик успешно отправлен!"),i.push(`/customer/orders/${k.params.id}/responders`))}catch(r){console.error("Ошибка при отклике:",r),alert(((e=(l=r.response)==null?void 0:l.data)==null?void 0:e.message)||"Ошибка при отправке отклика")}},q=()=>{i.push(`/customer/orders/${k.params.id}/responders`)},E=l=>{i.push(`/contractor/${l}`)},H=()=>{i.push(`/order/${k.params.id}/feedback`)},J=()=>{b.value=!0},K=async()=>{var l,e;b.value=!1;try{if(!c.value){i.push("/login");return}(await C.delete(`/api/orders/${k.params.id}`,{headers:{Authorization:`Bearer ${c.value}`}})).status===200&&(T("Заказ успешно удален!","success"),setTimeout(()=>{i.push("/customer/active-orders")},1500))}catch(r){console.error("Ошибка при удалении заказа:",r),T(((e=(l=r.response)==null?void 0:l.data)==null?void 0:e.message)||"Произошла ошибка при удалении заказа","error")}};return(l,e)=>(n(),m(X,{class:"py-10"},{default:t(()=>[u.value?(n(),m(w,{key:0,class:"mx-auto pa-6","max-width":"800",elevation:"10",rounded:"2xl"},{default:t(()=>[s(I,{class:"d-flex justify-space-between align-center"},{default:t(()=>[o("span",ne,d(u.value.ord_title),1),s(S,{color:"blue lighten-2","text-color":"white"},{default:t(()=>[a(d(u.value.ord_status),1)]),_:1})]),_:1}),s(j,null,{default:t(()=>[o("p",de,[e[6]||(e[6]=o("strong",null,"Описание:",-1)),e[7]||(e[7]=o("br",null,null,-1)),a(" "+d(u.value.ord_text),1)]),s(ee,{class:"mb-4"},{default:t(()=>[s(P,{cols:"12",sm:"6"},{default:t(()=>[s(A,{class:"mr-1",color:"green"},{default:t(()=>e[8]||(e[8]=[a("mdi-currency-rub")])),_:1}),e[9]||(e[9]=o("strong",null,"Цена:",-1)),a(" "+d(u.value.ord_price)+" ₽ ",1)]),_:1}),s(P,{cols:"12",sm:"6"},{default:t(()=>[s(A,{class:"mr-1",color:"orange"},{default:t(()=>e[10]||(e[10]=[a("mdi-clock-outline")])),_:1}),e[11]||(e[11]=o("strong",null,"Срок:",-1)),a(" "+d(u.value.ord_time),1)]),_:1})]),_:1}),u.value.ord_status==="Завершен"&&v.value?(n(),m(w,{key:0,class:"mb-4 pa-4",variant:"outlined"},{default:t(()=>[o("div",ie,[s(A,{color:"success",class:"mr-2"},{default:t(()=>e[12]||(e[12]=[a("mdi-account-check")])),_:1}),e[13]||(e[13]=o("strong",null,"Утвержденный исполнитель:",-1))]),s(w,{class:"contractor-card pa-3",onClick:e[0]||(e[0]=r=>E(v.value.contractorId))},{default:t(()=>[o("div",ce,[s(te,{size:"40",color:"primary",class:"mr-3"},{default:t(()=>[o("span",pe,d(v.value.userName?v.value.userName.charAt(0).toUpperCase():""),1)]),_:1}),o("div",null,[o("div",ve,d(v.value.userSurname)+" "+d(v.value.userName)+" "+d(v.value.userPatronymic),1),e[14]||(e[14]=o("div",{class:"text-caption text-grey"},"Нажмите, чтобы просмотреть профиль",-1))])])]),_:1})]),_:1})):V("",!0),s(se,{class:"my-4"}),o("div",me,[e[15]||(e[15]=o("strong",null,"Технологии:",-1)),o("div",fe,[(n(!0),$(B,null,re(N.value,r=>(n(),m(S,{key:r.id,color:"deep-purple accent-4","text-color":"white",class:"ma-1",label:"",pill:""},{default:t(()=>[a(d(r.title),1)]),_:2},1024))),128))])])]),_:1}),s(F,{class:"d-flex justify-space-between"},{default:t(()=>[s(f,{color:"grey",variant:"outlined",onClick:e[1]||(e[1]=r=>l.$router.back())},{default:t(()=>e[16]||(e[16]=[a("Назад")])),_:1}),Array.isArray(g.value.roles)?(n(),$(B,{key:0},[g.value.roles.includes("customer")?(n(),$(B,{key:0},[u.value.ord_status!=="Завершен"?(n(),m(f,{key:0,color:"primary",onClick:q},{default:t(()=>e[17]||(e[17]=[a(" Откликнувшиеся ")])),_:1})):V("",!0),u.value.ord_status==="Завершен"?(n(),m(f,{key:1,color:"success",onClick:H},{default:t(()=>e[18]||(e[18]=[a(" Оставить отзыв ")])),_:1})):V("",!0)],64)):g.value.roles.includes("contractor")?(n(),m(f,{key:1,color:"success",onClick:h},{default:t(()=>e[19]||(e[19]=[a(" Откликнуться ")])),_:1})):V("",!0)],64)):V("",!0),g.value&&Array.isArray(g.value.roles)&&g.value.roles.includes("customer")&&u.value&&u.value.ord_status==="Новый"?(n(),m(f,{key:1,color:"error",onClick:J},{default:t(()=>e[20]||(e[20]=[a(" Удалить заказ ")])),_:1})):V("",!0)]),_:1})]),_:1})):(n(),$("div",ge,[s(ae,{indeterminate:"",color:"primary",size:"50"}),e[21]||(e[21]=o("p",{class:"mt-3"},"Загрузка заказа...",-1))])),s(le,{modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=r=>b.value=r),"max-width":"400"},{default:t(()=>[s(w,null,{default:t(()=>[s(I,{class:"text-h5"},{default:t(()=>e[22]||(e[22]=[a(" Подтверждение удаления ")])),_:1}),s(j,null,{default:t(()=>e[23]||(e[23]=[a(" Вы уверены, что хотите удалить этот заказ? Это действие нельзя будет отменить. ")])),_:1}),s(F,null,{default:t(()=>[s(oe),s(f,{color:"grey-darken-1",variant:"text",onClick:e[2]||(e[2]=r=>b.value=!1)},{default:t(()=>e[24]||(e[24]=[a(" Отмена ")])),_:1}),s(f,{color:"error",variant:"text",onClick:K},{default:t(()=>e[25]||(e[25]=[a(" Удалить ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(ue,{modelValue:x.value.show,"onUpdate:modelValue":e[5]||(e[5]=r=>x.value.show=r),color:x.value.color,timeout:3e3,location:"top"},{actions:t(()=>[s(f,{variant:"text",onClick:e[4]||(e[4]=r=>x.value.show=!1)},{default:t(()=>e[26]||(e[26]=[a(" Закрыть ")])),_:1})]),default:t(()=>[a(d(x.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1}))}},Ve=Q(ye,[["__scopeId","data-v-bbb26518"]]);export{Ve as default};
