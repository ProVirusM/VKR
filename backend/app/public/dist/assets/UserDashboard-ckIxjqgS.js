import{r as m,b as G,d as w,o as d,e as y,f as o,g as t,i as A,V as a,a0 as H,a1 as J,a as v,t as V,h as _,A as r,l as f,c as g,C as K,D as Q,Z as W,p as s,x as h,F as x,a2 as X,m as Y,u as ee}from"./index-CLuajfPy.js";const oe={class:"text-h5 font-weight-bold mb-1"},te={class:"d-flex justify-space-between align-center mb-2"},re={key:0,class:"text-body-1"},se={class:"d-flex justify-end"},ne={__name:"UserDashboard",setup(le){const i=m({}),l=ee(),b=m(""),k=m(!1),c=m(""),C=m(!1),p=m({show:!1,text:"",color:"success"}),T=(n,e="success")=>{p.value={show:!0,text:n,color:e}};G(async()=>{var n;try{const e=localStorage.getItem("token");if(!e){l.push("/login");return}const[u,Z]=await Promise.all([w.get("/api/profile",{headers:{Authorization:`Bearer ${e}`}}),w.get("/api/contractors/me",{headers:{Authorization:`Bearer ${e}`}}).catch(q=>(console.error("Ошибка при загрузке данных исполнителя:",q),{data:{description:""}}))]);i.value=u.data,u.data.roles.includes("contractor")&&(b.value=Z.data.description||"")}catch(e){console.error("Ошибка при загрузке данных:",e),((n=e.response)==null?void 0:n.status)===401&&l.push("/login")}});const j=()=>{c.value=b.value,k.value=!0},B=()=>{k.value=!1,c.value=""},D=async()=>{try{C.value=!0;const n=localStorage.getItem("token");await w.put("/api/contractors/me",{text:c.value},{headers:{Authorization:`Bearer ${n}`}}),b.value=c.value,k.value=!1,T("Описание успешно обновлено")}catch(n){console.error("Ошибка при сохранении описания:",n),T("Ошибка при сохранении описания","error")}finally{C.value=!1}},R=()=>l.push("/customer/create-order"),O=()=>l.push("/customer/orders"),S=()=>l.push("/contractor/reviews"),N=()=>l.push("/contractor/approved-orders"),z=()=>l.push("/contractor/responded-orders"),E=()=>l.push("/customer/active-orders"),M=()=>l.push("/customer/completed-orders"),$=()=>l.push("/contractor/projects"),F=()=>l.push("/contractor/create-project"),I=()=>l.push("/admin/languages"),P=()=>l.push("/admin/directions"),U=()=>l.push("/admin/technologies"),L=()=>l.push("/admin/reports");return(n,e)=>(d(),y(Y,{class:"py-8"},{default:o(()=>[t(_,{elevation:"10",rounded:"xl",class:"pa-6 bg-grey-lighten-5"},{default:o(()=>[t(A,{justify:"center"},{default:o(()=>[t(a,{cols:"12",md:"6",class:"text-center"},{default:o(()=>[t(H,{size:"120",class:"mb-4 mx-auto"},{default:o(()=>[t(J,{src:"https://www.w3schools.com/w3images/avatar2.png",alt:"Avatar"})]),_:1}),v("h2",oe,"Добро пожаловать, "+V(i.value.name)+"!",1),e[3]||(e[3]=v("p",{class:"text-subtitle-1 text-grey-darken-1"},"Ваш личный кабинет",-1))]),_:1})]),_:1}),Array.isArray(i.value.roles)&&i.value.roles.includes("contractor")?(d(),y(_,{key:0,class:"mb-6 pa-4",variant:"outlined"},{default:o(()=>[v("div",te,[e[4]||(e[4]=v("div",{class:"text-h6"},"О себе",-1)),k.value?f("",!0):(d(),y(r,{key:0,icon:"mdi-pencil",variant:"text",onClick:j}))]),k.value?(d(),y(K,{key:1,onSubmit:Q(D,["prevent"])},{default:o(()=>[t(W,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=u=>c.value=u),label:"Опишите себя и свой опыт",rows:"4","auto-grow":"","hide-details":"",class:"mb-2"},null,8,["modelValue"]),v("div",se,[t(r,{color:"error",variant:"text",class:"mr-2",onClick:B},{default:o(()=>e[5]||(e[5]=[s(" Отмена ")])),_:1}),t(r,{color:"primary",type:"submit",loading:C.value},{default:o(()=>e[6]||(e[6]=[s(" Сохранить ")])),_:1},8,["loading"])])]),_:1})):(d(),g("div",re,V(b.value||"Нет описания"),1))]),_:1})):f("",!0),t(h,{class:"my-6"}),t(A,{dense:"",justify:"center"},{default:o(()=>[Array.isArray(i.value.roles)?(d(),g(x,{key:0},[i.value.roles.includes("customer")?(d(),g(x,{key:0},[t(a,{cols:"12",md:"4"},{default:o(()=>[t(r,{block:"",color:"primary",onClick:R,"prepend-icon":"mdi-plus-box"},{default:o(()=>e[7]||(e[7]=[s(" Создать заказ ")])),_:1})]),_:1}),t(a,{cols:"12",md:"4"},{default:o(()=>[t(r,{block:"",color:"blue-darken-1",onClick:E,"prepend-icon":"mdi-briefcase-clock-outline"},{default:o(()=>e[8]||(e[8]=[s(" Активные заказы ")])),_:1})]),_:1}),t(a,{cols:"12",md:"4"},{default:o(()=>[t(r,{block:"",color:"indigo",onClick:M,"prepend-icon":"mdi-history"},{default:o(()=>e[9]||(e[9]=[s(" История заказов ")])),_:1})]),_:1})],64)):f("",!0),i.value.roles.includes("contractor")?(d(),g(x,{key:1},[t(a,{cols:"12",md:"4"},{default:o(()=>[t(r,{block:"",color:"green-darken-2",onClick:S,"prepend-icon":"mdi-star-outline"},{default:o(()=>e[10]||(e[10]=[s(" Мои отзывы ")])),_:1})]),_:1}),t(a,{cols:"12",md:"4"},{default:o(()=>[t(r,{block:"",color:"teal-darken-2",onClick:N,"prepend-icon":"mdi-check-bold"},{default:o(()=>e[11]||(e[11]=[s(" Утвержденные заказы ")])),_:1})]),_:1}),t(a,{cols:"12",md:"4"},{default:o(()=>[t(r,{block:"",color:"amber-darken-2",onClick:z,"prepend-icon":"mdi-message-reply-text-outline"},{default:o(()=>e[12]||(e[12]=[s(" Отозвавшиеся заказы ")])),_:1})]),_:1}),t(a,{cols:"12",md:"4"},{default:o(()=>[t(r,{block:"",color:"primary",onClick:$,"prepend-icon":"mdi-folder-multiple-outline"},{default:o(()=>e[13]||(e[13]=[s(" Мои проекты ")])),_:1})]),_:1}),t(a,{cols:"12",md:"4"},{default:o(()=>[t(r,{block:"",color:"primary",onClick:F,"prepend-icon":"mdi-plus-box-outline"},{default:o(()=>e[14]||(e[14]=[s(" Создать проект ")])),_:1})]),_:1}),t(a,{cols:"12",md:"4"},{default:o(()=>[t(r,{block:"",color:"blue-grey",onClick:O,"prepend-icon":"mdi-briefcase"},{default:o(()=>e[15]||(e[15]=[s(" Заказы ")])),_:1})]),_:1})],64)):f("",!0),i.value.roles.includes("admin")?(d(),g(x,{key:2},[t(a,{cols:"12",md:"4"},{default:o(()=>[t(r,{block:"",color:"purple-darken-2",onClick:I,"prepend-icon":"mdi-code-braces"},{default:o(()=>e[16]||(e[16]=[s(" Языки программирования ")])),_:1})]),_:1}),t(a,{cols:"12",md:"4"},{default:o(()=>[t(r,{block:"",color:"indigo-darken-2",onClick:P,"prepend-icon":"mdi-arrow-decision"},{default:o(()=>e[17]||(e[17]=[s(" Направления ")])),_:1})]),_:1}),t(a,{cols:"12",md:"4"},{default:o(()=>[t(r,{block:"",color:"blue-darken-2",onClick:U,"prepend-icon":"mdi-cog"},{default:o(()=>e[18]||(e[18]=[s(" Технологии ")])),_:1})]),_:1}),t(a,{cols:"12",md:"4"},{default:o(()=>[t(r,{block:"",color:"cyan-darken-2",onClick:L,"prepend-icon":"mdi-chart-bar"},{default:o(()=>e[19]||(e[19]=[s(" Отчеты ")])),_:1})]),_:1})],64)):f("",!0)],64)):f("",!0)]),_:1}),t(h,{class:"my-6"})]),_:1}),t(X,{modelValue:p.value.show,"onUpdate:modelValue":e[2]||(e[2]=u=>p.value.show=u),color:p.value.color,timeout:3e3,location:"top"},{actions:o(()=>[t(r,{variant:"text",onClick:e[1]||(e[1]=u=>p.value.show=!1)},{default:o(()=>e[20]||(e[20]=[s(" Закрыть ")])),_:1})]),default:o(()=>[s(V(p.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1}))}};export{ne as default};
