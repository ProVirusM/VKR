import{_ as W,r as p,b as X,d as x,e as g,f as s,m as Z,a3 as ee,u as se,o as d,h as _,g as a,a as l,t as i,v as j,p as r,n as I,i as te,V as O,Y as h,a0 as ae,l as b,x as re,c as B,k as oe,F as z,q as P,A as y,z as F,a4 as le,a5 as ue,a6 as ne,a2 as de}from"./index-BAPhhIwE.js";const ie={class:"text-h5 font-weight-bold"},ce={class:"mb-3 text-body-1"},pe={class:"d-flex align-center mb-2"},ve={class:"d-flex align-center"},fe={class:"text-h6 white--text"},me={class:"text-subtitle-1 font-weight-bold"},ge={class:"mb-3"},ye={class:"mt-2 d-flex flex-wrap gap-2"},ke={key:1,class:"text-center mt-10"},xe={__name:"OrderDetails",setup(Ve){const V=ee(),v=se(),u=p(null),R=p([]),c=p(null),U=p(!0),L=p(null),f=p(null),A=p(!1),C=p(!1),w=p({show:!1,text:"",color:"success"}),$=(o,e="success")=>{w.value={show:!0,text:o,color:e}},n=p("");X(()=>{if(n.value=localStorage.getItem("token")||"",!n.value){v.push("/login");return}q()});const q=async()=>{var o,e,t,T,D,N;try{const m=V.params.id,[S,Q]=await Promise.all([x.get(`/api/orders/${m}/full`,{headers:{Authorization:`Bearer ${n.value}`}}),x.get("/api/profile",{headers:{Authorization:`Bearer ${n.value}`}})]);if(u.value=((o=S.data)==null?void 0:o.order)||null,R.value=((e=S.data)==null?void 0:e.stacks)||[],c.value=Q.data||null,c.value&&Array.isArray(c.value.roles)&&c.value.roles.includes("contractor"))try{const k=await x.get(`/api/orders/${m}/check-response`,{headers:{Authorization:`Bearer ${n.value}`}});C.value=k.data.hasResponded}catch(k){console.error("Ошибка при проверке отклика:",k)}if(((t=u.value)==null?void 0:t.ord_status)==="Завершен")try{const k=await x.get(`/api/orders/${m}/approved-contractor`,{headers:{Authorization:`Bearer ${n.value}`}});f.value=k.data}catch(k){console.error("Ошибка при загрузке утвержденного исполнителя:",k)}}catch(m){L.value=((D=(T=m.response)==null?void 0:T.data)==null?void 0:D.message)||m.message,console.error("Ошибка:",m),((N=m.response)==null?void 0:N.status)===401&&v.push("/login")}finally{U.value=!1}},E=async()=>{var o,e;try{if(!n.value){v.push("/login");return}(await x.post(`/api/orders/${V.params.id}/respond`,{},{headers:{Authorization:`Bearer ${n.value}`,"Content-Type":"application/json"}})).status===201&&($("Отклик успешно отправлен!","success"),C.value=!0)}catch(t){console.error("Ошибка при отклике:",t),$(((e=(o=t.response)==null?void 0:o.data)==null?void 0:e.message)||"Ошибка при отправке отклика","error")}},M=async()=>{var o,e;try{if(!n.value){v.push("/login");return}(await x.post(`/api/orders/${V.params.id}/cancel-response`,{},{headers:{Authorization:`Bearer ${n.value}`,"Content-Type":"application/json"}})).status===200&&($("Отклик успешно отменен!","success"),C.value=!1)}catch(t){console.error("Ошибка при отмене отклика:",t),$(((e=(o=t.response)==null?void 0:o.data)==null?void 0:e.message)||"Ошибка при отмене отклика","error")}},Y=()=>{v.push(`/customer/orders/${V.params.id}/responders`)},G=o=>{v.push(`/contractor/${o}`)},H=()=>{v.push(`/order/${V.params.id}/feedback`)},J=()=>{A.value=!0},K=async()=>{var o,e;A.value=!1;try{if(!n.value){v.push("/login");return}(await x.delete(`/api/orders/${V.params.id}`,{headers:{Authorization:`Bearer ${n.value}`}})).status===200&&($("Заказ успешно удален!","success"),setTimeout(()=>{v.push("/customer/active-orders")},1500))}catch(t){console.error("Ошибка при удалении заказа:",t),$(((e=(o=t.response)==null?void 0:o.data)==null?void 0:e.message)||"Произошла ошибка при удалении заказа","error")}};return(o,e)=>(d(),g(Z,{class:"py-10"},{default:s(()=>[u.value?(d(),g(_,{key:0,class:"mx-auto pa-6","max-width":"800",elevation:"10",rounded:"2xl"},{default:s(()=>[a(I,{class:"d-flex justify-space-between align-center"},{default:s(()=>[l("span",ie,i(u.value.ord_title),1),a(j,{color:"blue lighten-2","text-color":"white"},{default:s(()=>[r(i(u.value.ord_status),1)]),_:1})]),_:1}),a(P,null,{default:s(()=>[l("p",ce,[e[7]||(e[7]=l("strong",null,"Описание:",-1)),e[8]||(e[8]=l("br",null,null,-1)),r(" "+i(u.value.ord_text),1)]),a(te,{class:"mb-4"},{default:s(()=>[a(O,{cols:"12",sm:"6"},{default:s(()=>[a(h,{class:"mr-1",color:"green"},{default:s(()=>e[9]||(e[9]=[r("mdi-currency-rub")])),_:1}),e[10]||(e[10]=l("strong",null,"Цена:",-1)),r(" "+i(u.value.ord_price)+" ₽ ",1)]),_:1}),a(O,{cols:"12",sm:"6"},{default:s(()=>[a(h,{class:"mr-1",color:"orange"},{default:s(()=>e[11]||(e[11]=[r("mdi-clock-outline")])),_:1}),e[12]||(e[12]=l("strong",null,"Срок:",-1)),r(" "+i(u.value.ord_time),1)]),_:1})]),_:1}),u.value.ord_status==="Завершен"&&f.value?(d(),g(_,{key:0,class:"mb-4 pa-4",variant:"outlined"},{default:s(()=>[l("div",pe,[a(h,{color:"success",class:"mr-2"},{default:s(()=>e[13]||(e[13]=[r("mdi-account-check")])),_:1}),e[14]||(e[14]=l("strong",null,"Утвержденный исполнитель:",-1))]),a(_,{class:"contractor-card pa-3",onClick:e[0]||(e[0]=t=>G(f.value.contractorId))},{default:s(()=>[l("div",ve,[a(ae,{size:"40",color:"primary",class:"mr-3"},{default:s(()=>[l("span",fe,i(f.value.userName?f.value.userName.charAt(0).toUpperCase():""),1)]),_:1}),l("div",null,[l("div",me,i(f.value.userSurname)+" "+i(f.value.userName)+" "+i(f.value.userPatronymic),1),e[15]||(e[15]=l("div",{class:"text-caption text-grey"},"Нажмите, чтобы просмотреть профиль",-1))])])]),_:1})]),_:1})):b("",!0),a(re,{class:"my-4"}),l("div",ge,[e[16]||(e[16]=l("strong",null,"Технологии:",-1)),l("div",ye,[(d(!0),B(z,null,oe(R.value,t=>(d(),g(j,{key:t.id,color:"deep-purple accent-4","text-color":"white",class:"ma-1",label:"",pill:""},{default:s(()=>[r(i(t.title),1)]),_:2},1024))),128))])])]),_:1}),a(F,{class:"d-flex justify-space-between"},{default:s(()=>[a(y,{color:"grey",variant:"outlined",onClick:e[1]||(e[1]=t=>o.$router.back())},{default:s(()=>e[17]||(e[17]=[r("Назад")])),_:1}),Array.isArray(c.value.roles)?(d(),B(z,{key:0},[c.value.roles.includes("customer")?(d(),B(z,{key:0},[u.value.ord_status!=="Завершен"?(d(),g(y,{key:0,color:"primary",onClick:Y},{default:s(()=>e[18]||(e[18]=[r(" Откликнувшиеся ")])),_:1})):b("",!0),u.value.ord_status==="Завершен"?(d(),g(y,{key:1,color:"success",onClick:H},{default:s(()=>e[19]||(e[19]=[r(" Оставить отзыв ")])),_:1})):b("",!0)],64)):c.value.roles.includes("contractor")?(d(),g(y,{key:1,color:C.value?"error":"success",onClick:e[2]||(e[2]=t=>C.value?M():E())},{default:s(()=>[r(i(C.value?"Отменить отклик":"Откликнуться"),1)]),_:1},8,["color"])):b("",!0)],64)):b("",!0),c.value&&Array.isArray(c.value.roles)&&c.value.roles.includes("customer")&&u.value&&u.value.ord_status==="Новый"?(d(),g(y,{key:1,color:"error",onClick:J},{default:s(()=>e[20]||(e[20]=[r(" Удалить заказ ")])),_:1})):b("",!0)]),_:1})]),_:1})):(d(),B("div",ke,[a(le,{indeterminate:"",color:"primary",size:"50"}),e[21]||(e[21]=l("p",{class:"mt-3"},"Загрузка заказа...",-1))])),a(ne,{modelValue:A.value,"onUpdate:modelValue":e[4]||(e[4]=t=>A.value=t),"max-width":"400"},{default:s(()=>[a(_,null,{default:s(()=>[a(I,{class:"text-h5"},{default:s(()=>e[22]||(e[22]=[r(" Подтверждение удаления ")])),_:1}),a(P,null,{default:s(()=>e[23]||(e[23]=[r(" Вы уверены, что хотите удалить этот заказ? Это действие нельзя будет отменить. ")])),_:1}),a(F,null,{default:s(()=>[a(ue),a(y,{color:"grey-darken-1",variant:"text",onClick:e[3]||(e[3]=t=>A.value=!1)},{default:s(()=>e[24]||(e[24]=[r(" Отмена ")])),_:1}),a(y,{color:"error",variant:"text",onClick:K},{default:s(()=>e[25]||(e[25]=[r(" Удалить ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(de,{modelValue:w.value.show,"onUpdate:modelValue":e[6]||(e[6]=t=>w.value.show=t),color:w.value.color,timeout:3e3,location:"top"},{actions:s(()=>[a(y,{variant:"text",onClick:e[5]||(e[5]=t=>w.value.show=!1)},{default:s(()=>e[26]||(e[26]=[r(" Закрыть ")])),_:1})]),default:s(()=>[r(i(w.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1}))}},we=W(xe,[["__scopeId","data-v-3c92a9a5"]]);export{we as default};
