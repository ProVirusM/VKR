import{r as u,b as S,e as z,f as i,m as B,d,o as j,g as t,n as _,p as s,C as A,D as F,i as L,V as p,j as V,E as b,A as g,t as k,a6 as M,h as w,q as I,z as R,a5 as G}from"./index-Bjf0RIAy.js";import{V as H}from"./VDataTable-Dk1eHKHv.js";import"./VTable-BSs-gSsr.js";const Q={__name:"Technologies",setup(J){const y=u([]),m=u([]),v=u([]),r=u(!1),c=u(!1),C=[{title:"ID",key:"id"},{title:"Название",key:"title"},{title:"Направление",key:"direction"},{title:"Язык программирования",key:"language"},{title:"Действия",key:"actions",sortable:!1}],o=u({title:"",direction_id:null,language_id:null}),n=u({id:null,title:"",direction_id:null,language_id:null}),f=async()=>{r.value=!0;try{const a=await d.get("/api/stacks/all");y.value=a.data}catch(a){console.error("Error fetching technologies:",a)}finally{r.value=!1}},T=async()=>{try{const a=await d.get("/api/directions");m.value=a.data}catch(a){console.error("Error fetching directions:",a)}},x=async()=>{try{const a=await d.get("/api/languages");v.value=a.data}catch(a){console.error("Error fetching languages:",a)}},D=a=>{const e=m.value.find(l=>l.id===a);return e?e.title:""},h=a=>{const e=v.value.find(l=>l.id===a);return e?e.title:""},q=async()=>{var a;if(!(!o.value.title||!o.value.direction_id||!o.value.language_id)){r.value=!0;try{await d.post("/api/stacks/",o.value),o.value={title:"",direction_id:null,language_id:null},await f()}catch(e){console.error("Error creating technology:",e),((a=e.response)==null?void 0:a.status)===409?alert("Технология с таким названием уже существует"):alert("Ошибка при создании технологии")}finally{r.value=!1}}},E=a=>{n.value={...a},c.value=!0},U=async()=>{var a;if(!(!n.value.title||!n.value.direction_id||!n.value.language_id)){r.value=!0;try{await d.put(`/api/stacks/${n.value.id}`,{title:n.value.title,direction_id:n.value.direction_id,language_id:n.value.language_id}),c.value=!1,await f()}catch(e){console.error("Error updating technology:",e),((a=e.response)==null?void 0:a.status)===409?alert("Технология с таким названием уже существует"):alert("Ошибка при обновлении технологии")}finally{r.value=!1}}},$=async a=>{if(confirm("Вы уверены, что хотите удалить эту технологию?")){r.value=!0;try{await d.delete(`/api/stacks/${a.id}`),await f()}catch(e){console.error("Error deleting technology:",e)}finally{r.value=!1}}};return S(()=>{f(),T(),x()}),(a,e)=>(j(),z(B,null,{default:i(()=>[t(w,{class:"pa-6"},{default:i(()=>[t(_,{class:"text-h5 mb-4"},{default:i(()=>e[8]||(e[8]=[s(" Управление технологиями ")])),_:1}),t(A,{onSubmit:F(q,["prevent"]),class:"mb-6"},{default:i(()=>[t(L,null,{default:i(()=>[t(p,{cols:"12",md:"4"},{default:i(()=>[t(V,{modelValue:o.value.direction_id,"onUpdate:modelValue":e[0]||(e[0]=l=>o.value.direction_id=l),items:m.value,"item-title":"title","item-value":"id",label:"Направление",required:""},null,8,["modelValue","items"])]),_:1}),t(p,{cols:"12",md:"4"},{default:i(()=>[t(V,{modelValue:o.value.language_id,"onUpdate:modelValue":e[1]||(e[1]=l=>o.value.language_id=l),items:v.value,"item-title":"title","item-value":"id",label:"Язык программирования",required:""},null,8,["modelValue","items"])]),_:1}),t(p,{cols:"12",md:"4"},{default:i(()=>[t(b,{modelValue:o.value.title,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.title=l),label:"Название технологии",required:"",rules:[l=>!!l||"Название обязательно"]},null,8,["modelValue","rules"])]),_:1}),t(p,{cols:"12",class:"d-flex justify-end"},{default:i(()=>[t(g,{color:"primary",type:"submit",loading:r.value,disabled:!o.value.title||!o.value.direction_id||!o.value.language_id},{default:i(()=>e[9]||(e[9]=[s(" Добавить технологию ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1}),t(H,{headers:C,items:y.value,loading:r.value,class:"elevation-1"},{"item.direction":i(({item:l})=>[s(k(D(l.direction_id)),1)]),"item.language":i(({item:l})=>[s(k(h(l.language_id)),1)]),"item.actions":i(({item:l})=>[t(g,{icon:"mdi-pencil",size:"small",color:"primary",class:"me-2",onClick:N=>E(l)},null,8,["onClick"]),t(g,{icon:"mdi-delete",size:"small",color:"error",onClick:N=>$(l)},null,8,["onClick"])]),_:1},8,["items","loading"]),t(M,{modelValue:c.value,"onUpdate:modelValue":e[7]||(e[7]=l=>c.value=l),"max-width":"500px"},{default:i(()=>[t(w,null,{default:i(()=>[t(_,null,{default:i(()=>e[10]||(e[10]=[s("Редактировать технологию")])),_:1}),t(I,null,{default:i(()=>[t(V,{modelValue:n.value.direction_id,"onUpdate:modelValue":e[3]||(e[3]=l=>n.value.direction_id=l),items:m.value,"item-title":"title","item-value":"id",label:"Направление",required:"",class:"mb-4"},null,8,["modelValue","items"]),t(V,{modelValue:n.value.language_id,"onUpdate:modelValue":e[4]||(e[4]=l=>n.value.language_id=l),items:v.value,"item-title":"title","item-value":"id",label:"Язык программирования",required:"",class:"mb-4"},null,8,["modelValue","items"]),t(b,{modelValue:n.value.title,"onUpdate:modelValue":e[5]||(e[5]=l=>n.value.title=l),label:"Название технологии",required:""},null,8,["modelValue"])]),_:1}),t(R,null,{default:i(()=>[t(G),t(g,{color:"error",onClick:e[6]||(e[6]=l=>c.value=!1)},{default:i(()=>e[11]||(e[11]=[s("Отмена")])),_:1}),t(g,{color:"primary",onClick:U},{default:i(()=>e[12]||(e[12]=[s("Сохранить")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}))}};export{Q as default};
