import{_ as R,r as k,b as j,e as m,f as t,m as D,a3 as F,d as w,o as l,g as a,V as d,a as y,x as I,i as p,A as _,p as r,t as n,l as $,c as N,F as M,k as P,h as z,Y as U,a2 as q,u as E,a7 as L,a0 as Y,n as G,a8 as H,q as J,v as K,z as Q}from"./index-CpoxufQo.js";const W={key:1,class:"contractors-list"},X={class:"text-h4 white--text"},Z={__name:"OrderContractors",setup(ee){const i=k([]),V=E(),C=F().params.id,f=k(!1),g=k("desc"),B=()=>{g.value=g.value==="desc"?"asc":"desc",i.value.sort((o,e)=>g.value==="desc"?(e.rating??0)-(o.rating??0):(o.rating??0)-(e.rating??0))},u=k({show:!1,text:"",color:"success"}),v=(o,e="success")=>{u.value={show:!0,text:o,color:e}},S=async o=>{var s,x,h,b;f.value=!0;const e=localStorage.getItem("token");try{const c=await w.post(`/api/orders/${C}/approve-contractor/${o}`,{},{headers:{Authorization:`Bearer ${e}`}});c.data.message?v(c.data.message,"success"):v("Исполнитель успешно одобрен!","success"),V.push("/customer/completed-orders")}catch(c){console.error("Ошибка при одобрении исполнителя",c);const T=((x=(s=c.response)==null?void 0:s.data)==null?void 0:x.message)||((b=(h=c.response)==null?void 0:h.data)==null?void 0:b.error)||"Не удалось одобрить исполнителя";v(T,"error")}finally{f.value=!1}},A=o=>{V.push(`/contractor/${o}`)},O=async()=>{f.value=!0;const o=localStorage.getItem("token");try{const e=await w.get(`/api/orders/${C}/contractors-with-rating`,{headers:{Authorization:`Bearer ${o}`}});i.value=e.data}catch(e){console.error("Ошибка при загрузке исполнителей",e),v("Не удалось загрузить список исполнителей","error")}finally{f.value=!1}};return j(()=>{O()}),(o,e)=>(l(),m(D,{class:"pa-8"},{default:t(()=>[a(p,{justify:"center",class:"mb-8"},{default:t(()=>[a(d,{cols:"12",class:"text-center"},{default:t(()=>[e[2]||(e[2]=y("h1",{class:"text-h3 font-weight-bold mb-2"}," Откликнувшиеся исполнители ",-1)),a(I,{class:"mx-auto",style:{"max-width":"200px"}})]),_:1})]),_:1}),i.value.length?(l(),m(p,{key:0},{default:t(()=>[a(d,{cols:"12",class:"mb-4 text-right"},{default:t(()=>[a(_,{color:"primary",onClick:B},{default:t(()=>[r(" Отсортировать по рейтингу "+n(g.value==="desc"?"↓":"↑"),1)]),_:1})]),_:1})]),_:1})):$("",!0),i.value.length?(l(),N("div",W,[a(p,null,{default:t(()=>[(l(!0),N(M,null,P(i.value,s=>(l(),m(d,{key:s.contractorId,cols:"12",class:"mb-6"},{default:t(()=>[a(z,{class:"contractor-card h-100",elevation:"4",rounded:"xl",loading:f.value},{default:t(()=>[a(L,null,{prepend:t(()=>[a(Y,{size:"80",class:"mr-4",color:"primary",elevation:"4"},{default:t(()=>[y("span",X,n(s.userName?s.userName.charAt(0).toUpperCase():""),1)]),_:2},1024)]),default:t(()=>[a(G,{class:"text-h5 font-weight-bold"},{default:t(()=>[r(n(s.userSurname)+" "+n(s.userName)+" "+n(s.userPatronymic),1)]),_:2},1024),s.rating!==null?(l(),m(H,{key:0},{default:t(()=>[r(" Рейтинг: "+n(s.rating),1)]),_:2},1024)):$("",!0)]),_:2},1024),a(J,null,{default:t(()=>[a(K,{color:"primary",variant:"outlined",class:"mb-2","prepend-icon":"mdi-account-check"},{default:t(()=>e[3]||(e[3]=[r(" Исполнитель ")])),_:1})]),_:1}),a(I,{class:"mx-4"}),a(Q,{class:"pa-4"},{default:t(()=>[a(p,null,{default:t(()=>[a(d,{cols:"12"},{default:t(()=>[a(_,{block:"",color:"success",size:"large",variant:"elevated",class:"mb-2","prepend-icon":"mdi-check-circle",onClick:x=>S(s.contractorId)},{default:t(()=>e[4]||(e[4]=[r(" Одобрить ")])),_:2},1032,["onClick"])]),_:2},1024),a(d,{cols:"12"},{default:t(()=>[a(_,{block:"",color:"primary",size:"large",variant:"outlined","prepend-icon":"mdi-account-circle",onClick:x=>A(s.contractorId)},{default:t(()=>e[5]||(e[5]=[r(" Профиль ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["loading"])]),_:2},1024))),128))]),_:1})])):(l(),m(p,{key:2,justify:"center",class:"mt-16"},{default:t(()=>[a(d,{cols:"12",md:"8",lg:"6",class:"text-center"},{default:t(()=>[a(z,{class:"pa-8",variant:"outlined"},{default:t(()=>[a(U,{size:"64",color:"grey",class:"mb-4"},{default:t(()=>e[6]||(e[6]=[r(" mdi-account-group-outline ")])),_:1}),e[7]||(e[7]=y("h2",{class:"text-h4 font-weight-bold mb-2 text-grey"}," Нет откликнувшихся исполнителей ",-1)),e[8]||(e[8]=y("p",{class:"text-body-1 text-grey"}," Пока никто не откликнулся на ваш заказ. Пожалуйста, подождите. ",-1))]),_:1})]),_:1})]),_:1})),a(q,{modelValue:u.value.show,"onUpdate:modelValue":e[1]||(e[1]=s=>u.value.show=s),color:u.value.color,timeout:3e3},{actions:t(()=>[a(_,{variant:"text",onClick:e[0]||(e[0]=s=>u.value.show=!1)},{default:t(()=>e[9]||(e[9]=[r(" Закрыть ")])),_:1})]),default:t(()=>[r(n(u.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1}))}},se=R(Z,[["__scopeId","data-v-984d9ca5"]]);export{se as default};
