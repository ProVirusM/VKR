import{r as s,o as y,e as x,f as t,g as l,m as U,n as p,x as _,y as B,z as n,t as w,B as N,u as k,l as R,k as I,A as T,d as S}from"./index-DejXQ6j1.js";import{V as A}from"./VAlert-3D3yQNz9.js";const D={__name:"RegisterView",setup(F){const v=s(""),c=s(""),V=s(""),d=s(""),i=s(""),r=s(""),u=s(!1),q=T(),C=async()=>{var g,e,a,f;r.value="",u.value=!0;try{console.log("Начало регистрации");const o=await S.post("/api/register",{usr_name:v.value,usr_surname:c.value,usr_patronymic:V.value,email:d.value,password:i.value,role:"customer"});console.log("Регистрация успешна:",o.data),console.log("Попытка входа");const m=await S.post("/api/login_check",{email:d.value,password:i.value});console.log("Вход успешен:",m.data);const b=m.data.token;console.log("Токен получен:",b),localStorage.setItem("token",b),localStorage.setItem("name",m.data.name),localStorage.setItem("email",m.data.email),console.log("Перенаправление на /dashboard"),await q.push("/dashboard")}catch(o){console.error("Ошибка:",o),(e=(g=o.response)==null?void 0:g.data)!=null&&e.message?r.value=o.response.data.message:(f=(a=o.response)==null?void 0:a.data)!=null&&f.error?r.value=o.response.data.error:r.value="Произошла ошибка при регистрации"}finally{u.value=!1}};return(g,e)=>(y(),x(I,{class:"d-flex align-center justify-center fill-height"},{default:t(()=>[l(R,{class:"pa-6","max-width":"400",elevation:"12"},{default:t(()=>[l(U,{class:"text-h5 text-center mb-4"},{default:t(()=>e[5]||(e[5]=[p("Регистрация")])),_:1}),l(_,{onSubmit:B(C,["prevent"])},{default:t(()=>[l(n,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=a=>v.value=a),label:"Имя",required:""},null,8,["modelValue"]),l(n,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=a=>c.value=a),label:"Фамилия",required:""},null,8,["modelValue"]),l(n,{modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=a=>V.value=a),label:"Отчество",required:""},null,8,["modelValue"]),l(n,{modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=a=>d.value=a),label:"Email",type:"email",required:""},null,8,["modelValue"]),l(n,{modelValue:i.value,"onUpdate:modelValue":e[4]||(e[4]=a=>i.value=a),label:"Пароль",type:"password",required:""},null,8,["modelValue"]),r.value?(y(),x(A,{key:0,type:"error",class:"mt-3"},{default:t(()=>[p(w(r.value),1)]),_:1})):N("",!0),l(k,{type:"submit",color:"success",class:"mt-4",block:"",loading:u.value,disabled:u.value},{default:t(()=>[p(w(u.value?"Регистрация...":"Зарегистрироваться"),1)]),_:1},8,["loading","disabled"]),l(k,{variant:"text",class:"mt-2",block:"",to:"/login"},{default:t(()=>e[6]||(e[6]=[p("Уже есть аккаунт?")])),_:1})]),_:1})]),_:1})]),_:1}))}};export{D as default};
