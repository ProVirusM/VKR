import{G as M,H as J,I as D,J as E,K as U,g as l,L as N,M as L,N as j,O as H,P as A,Q as K,R as Q,S as W,T as X,U as G,F as Y,W as Z,X as z,B as _,r as n,o as k,e as P,f as s,n as h,p as i,C as ee,D as ae,E as x,a as C,Y as q,Z as le,l as O,$ as te,t as T,A as $,h as oe,m as se,u as re,d as B}from"./index-DUB7O3Gq.js";const ue=M({...J({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"VRadio"),F=D()({name:"VRadio",props:ue(),setup(t,f){let{slots:m}=f;return E(()=>{const r=U.filterProps(t);return l(U,N(r,{class:["v-radio",t.class],style:t.style,type:"radio"}),m)}),{}}}),ne=M({height:{type:[Number,String],default:"auto"},...L(),...j(H(),["multiple"]),trueIcon:{type:A,default:"$radioOn"},falseIcon:{type:A,default:"$radioOff"},type:{type:String,default:"radio"}},"VRadioGroup"),de=D()({name:"VRadioGroup",inheritAttrs:!1,props:ne(),emits:{"update:modelValue":t=>!0},setup(t,f){let{attrs:m,slots:r}=f;const g=K(),c=Q(()=>t.id||`radio-group-${g}`),u=W(t,"modelValue");return E(()=>{const[y,d]=X(m),p=G.filterProps(t),v=U.filterProps(t),b=r.label?r.label({label:t.label,props:{for:c.value}}):t.label;return l(G,N({class:["v-radio-group",t.class],style:t.style},y,p,{modelValue:u.value,"onUpdate:modelValue":I=>u.value=I,id:c.value}),{...r,default:I=>{let{id:V,messagesId:e,isDisabled:a,isReadonly:R}=I;return l(Y,null,[b&&l(Z,{id:V.value},{default:()=>[b]}),l(z,N(v,{id:V.value,"aria-describedby":e.value,defaultsTarget:"VRadio",trueIcon:t.trueIcon,falseIcon:t.falseIcon,type:t.type,disabled:a.value,readonly:R.value,"aria-labelledby":b?V.value:void 0,multiple:!1},d,{modelValue:u.value,"onUpdate:modelValue":o=>u.value=o}),r)])}})}),{}}}),ie={class:"d-flex align-center"},me={class:"d-flex align-center"},pe={__name:"RegisterView",setup(t){const f=_(),m=n(""),r=n(""),g=n(""),c=n(""),u=n(""),y=n(""),d=n(""),p=n(!1),v=n("customer"),b=re(),I=async()=>{var V,e,a,R;d.value="",p.value=!0;try{console.log("Начало регистрации");const o=await B.post("/api/register",{usr_name:m.value,usr_surname:r.value,usr_patronymic:g.value,email:c.value,password:u.value,role:v.value,description:v.value==="contractor"?y.value:void 0});console.log("Регистрация успешна:",o.data),console.log("Попытка входа");const S=await B.post("/api/login_check",{email:c.value,password:u.value});console.log("Вход успешен:",S.data);const w=S.data.token;console.log("Токен получен:",w),localStorage.setItem("token",w),localStorage.setItem("name",o.data.user.name),localStorage.setItem("surname",o.data.user.surname),localStorage.setItem("email",o.data.user.email),localStorage.setItem("roles",JSON.stringify(o.data.user.roles)),console.log("Перенаправление на /dashboard"),await f.login(w),await b.push("/dashboard")}catch(o){if(console.error("Ошибка:",o),(e=(V=o.response)==null?void 0:V.data)!=null&&e.message)d.value=o.response.data.message;else if((R=(a=o.response)==null?void 0:a.data)!=null&&R.error){const S={"User with this email already exists":"Пользователь с таким email уже существует","Missing required fields":"Не все обязательные поля заполнены"};d.value=S[o.response.data.error]||o.response.data.error}else d.value="Произошла ошибка при регистрации"}finally{p.value=!1}};return(V,e)=>(k(),P(se,{class:"d-flex align-center justify-center fill-height"},{default:s(()=>[l(oe,{class:"pa-6","max-width":"400",elevation:"12"},{default:s(()=>[l(h,{class:"text-h5 text-center mb-4"},{default:s(()=>e[7]||(e[7]=[i("Регистрация")])),_:1}),l(ee,{onSubmit:ae(I,["prevent"])},{default:s(()=>[l(x,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=a=>m.value=a),label:"Имя",required:""},null,8,["modelValue"]),l(x,{modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=a=>r.value=a),label:"Фамилия",required:""},null,8,["modelValue"]),l(x,{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=a=>g.value=a),label:"Отчество",required:""},null,8,["modelValue"]),l(x,{modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=a=>c.value=a),label:"Email",type:"email",required:""},null,8,["modelValue"]),l(x,{modelValue:u.value,"onUpdate:modelValue":e[4]||(e[4]=a=>u.value=a),label:"Пароль",type:"password",required:""},null,8,["modelValue"]),l(de,{modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=a=>v.value=a),class:"mt-4"},{label:s(()=>e[8]||(e[8]=[C("div",{class:"text-subtitle-1 font-weight-bold"},"Выберите роль:",-1)])),default:s(()=>[l(F,{value:"customer",color:"primary"},{label:s(()=>[C("div",ie,[l(q,{color:"primary",class:"mr-2"},{default:s(()=>e[9]||(e[9]=[i("mdi-account")])),_:1}),e[10]||(e[10]=i(" Заказчик "))])]),_:1}),l(F,{value:"contractor",color:"primary"},{label:s(()=>[C("div",me,[l(q,{color:"primary",class:"mr-2"},{default:s(()=>e[11]||(e[11]=[i("mdi-briefcase")])),_:1}),e[12]||(e[12]=i(" Исполнитель "))])]),_:1})]),_:1},8,["modelValue"]),v.value==="contractor"?(k(),P(le,{key:0,modelValue:y.value,"onUpdate:modelValue":e[6]||(e[6]=a=>y.value=a),label:"Опишите себя и свой опыт",rows:"4","auto-grow":"",class:"mt-4",rules:[a=>!a||a.length<=1e3||"Описание не должно превышать 1000 символов"],counter:""},null,8,["modelValue","rules"])):O("",!0),d.value?(k(),P(te,{key:1,type:"error",class:"mt-3"},{default:s(()=>[i(T(d.value),1)]),_:1})):O("",!0),l($,{type:"submit",color:"success",class:"mt-4",block:"",loading:p.value,disabled:p.value},{default:s(()=>[i(T(p.value?"Регистрация...":"Зарегистрироваться"),1)]),_:1},8,["loading","disabled"]),l($,{variant:"text",class:"mt-2",block:"",to:"/login"},{default:s(()=>e[13]||(e[13]=[i("Уже есть аккаунт?")])),_:1})]),_:1})]),_:1})]),_:1}))}};export{pe as default};
