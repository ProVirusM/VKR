import{_ as A,B as b,r as f,R as _,b as B,e as i,f as t,m as M,u as S,d as V,o as u,g as o,i as m,V as p,a as I,c as N,k as $,F as z,$ as R,p as c,h,A as D,t as g,a2 as F,a7 as L,a0 as T,Y as U,n as E,a8 as Y}from"./index-CLuajfPy.js";const j={__name:"Chats",setup(q){const l=S();b();const d=f([]),n=f({}),r=f({show:!1,text:"",color:"success"}),v=_(()=>Array.isArray(n.value.roles)&&n.value.roles.includes("customer")),x=_(()=>Array.isArray(n.value.roles)&&n.value.roles.includes("contractor")),y=(s,e="success")=>{r.value={show:!0,text:s,color:e}},k=s=>s.lastMessage?s.lastMessage.msg_text.length>50?s.lastMessage.msg_text.substring(0,50)+"...":s.lastMessage.msg_text:"Нет сообщений",w=async()=>{var s;try{const e=localStorage.getItem("token");if(!e){l.push("/login");return}const a=await V.get("/api/profile",{headers:{Authorization:`Bearer ${e}`}});n.value=a.data}catch(e){console.error("Ошибка при загрузке данных пользователя:",e),((s=e.response)==null?void 0:s.status)===401&&l.push("/login")}},C=async()=>{var s;try{const e=localStorage.getItem("token");if(!e){l.push("/login");return}const a=await V.get("/api/chats",{headers:{Authorization:`Bearer ${e}`}});d.value=a.data}catch(e){console.error("Ошибка при загрузке чатов:",e),y("Ошибка при загрузке чатов","error"),((s=e.response)==null?void 0:s.status)===401&&l.push("/login")}};return B(async()=>{if(await w(),!v.value&&!x.value){l.push("/dashboard");return}C()}),(s,e)=>(u(),i(M,{class:"py-8"},{default:t(()=>[o(h,{elevation:"10",rounded:"xl",class:"pa-6 bg-grey-lighten-5"},{default:t(()=>[o(m,null,{default:t(()=>[o(p,{cols:"12"},{default:t(()=>e[2]||(e[2]=[I("h2",{class:"text-h4 font-weight-bold mb-6"},"Мои чаты",-1)])),_:1})]),_:1}),d.value.length>0?(u(),i(m,{key:0},{default:t(()=>[(u(!0),N(z,null,$(d.value,a=>(u(),i(p,{key:a.id,cols:"12",md:"6",lg:"4"},{default:t(()=>[o(h,{class:"chat-card",to:"/chat/"+a.id,elevation:"2",hover:""},{default:t(()=>[o(L,null,{prepend:t(()=>[o(T,{color:"primary",size:"40"},{default:t(()=>[o(U,{icon:"mdi-account"})]),_:1})]),default:t(()=>[o(E,null,{default:t(()=>[c(g(v.value?a.contractor.user.name+" "+a.contractor.user.surname:a.customer.user.name+" "+a.customer.user.surname),1)]),_:2},1024),o(Y,null,{default:t(()=>[c(g(k(a)),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["to"])]),_:2},1024))),128))]),_:1})):(u(),i(m,{key:1},{default:t(()=>[o(p,{cols:"12",class:"text-center"},{default:t(()=>[o(R,{type:"info",variant:"tonal",class:"mx-auto","max-width":"500"},{default:t(()=>e[3]||(e[3]=[c(" У вас пока нет активных чатов ")])),_:1})]),_:1})]),_:1}))]),_:1}),o(F,{modelValue:r.value.show,"onUpdate:modelValue":e[1]||(e[1]=a=>r.value.show=a),color:r.value.color,timeout:3e3,location:"top"},{actions:t(()=>[o(D,{variant:"text",onClick:e[0]||(e[0]=a=>r.value.show=!1)},{default:t(()=>e[4]||(e[4]=[c(" Закрыть ")])),_:1})]),default:t(()=>[c(g(r.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1}))}},H=A(j,[["__scopeId","data-v-629f11e5"]]);export{H as default};
