import{_ as M,r as k,R as U,b as j,e as f,f as a,m as q,d as N,o as d,g as l,V as g,h as w,i as b,a0 as Y,a as s,t as n,v as z,p as c,n as S,a8 as A,Y as _,q as B,z as G,A as D,c as v,k as x,F as C,j as J,a2 as K,a3 as Q,u as W,D as R,a9 as X,aa as Z,l as ee,$ as te}from"./index-DUB7O3Gq.js";import{V as ae}from"./VTable-C_dcO4em.js";const le={class:"text-h3 white--text"},se={class:"text-grey-darken-1"},oe={class:"d-flex align-center mb-4"},re=["href"],ne={key:1,class:"text-grey"},ie={class:"d-flex align-center mb-4"},ue=["onClick"],de={key:1,class:"text-grey"},ce={class:"d-flex align-center justify-space-between mb-4"},me={class:"d-flex align-center"},fe={class:"font-weight-bold mb-1"},ve={class:"text-caption mt-1"},he={key:1,class:"text-grey"},pe={__name:"ContractorProfile",setup(ge){const E=Q(),y=W(),i=k(null),h=k({show:!1,text:"",color:"success"}),V=k("highToLow"),m=k(!1),F=[{title:"Сначала с высокой оценкой",value:"highToLow"},{title:"Сначала с низкой оценкой",value:"lowToHigh"},{title:"По дате (сначала новые)",value:"newToOld"},{title:"По дате (сначала старые)",value:"oldToNew"}],T=U(()=>{var e;if(!((e=i.value)!=null&&e.feedbacks))return[];const u=[...i.value.feedbacks];switch(V.value){case"highToLow":return u.sort((t,o)=>o.estimation-t.estimation);case"lowToHigh":return u.sort((t,o)=>t.estimation-o.estimation);case"newToOld":return u.sort((t,o)=>new Date(o.timestamp)-new Date(t.timestamp));case"oldToNew":return u.sort((t,o)=>new Date(t.timestamp)-new Date(o.timestamp));default:return u}}),L=async()=>{var u;try{const e=await N.get(`/api/contractors/${E.params.id}/full-profile`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});i.value=e.data,console.log("Contractor data:",i.value);const t=await N.get(`/api/chats/check/${i.value.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(console.log("Raw chat check response:",t),console.log("Chat check response data:",t.data),t.data.exists&&t.data.chatId){const o=Number(t.data.chatId);isNaN(o)?m.value=!1:m.value=o}else m.value=!1;console.log("Final existingChat value:",m.value)}catch(e){console.error("Error details:",((u=e.response)==null?void 0:u.data)||e),h.value={show:!0,text:"Ошибка загрузки профиля",color:"error"}}},O=u=>{y.push(`/projects/${u}`)},H=u=>{y.push(`/contractor/orders/${u}`)},P=async()=>{var u;try{if(console.log("Handle chat - existingChat value:",m.value),typeof m.value=="number"&&!isNaN(m.value))console.log("Navigating to existing chat:",m.value),y.push(`/chat/${m.value}`);else{console.log("Creating new chat for contractor:",i.value.id);const e=await N.post("/api/chats/create",{contractorId:i.value.id},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});console.log("New chat response:",e);const t=Number(e.data.id);if(!isNaN(t))console.log("Navigating to new chat:",t),y.push(`/chat/${t}`);else throw new Error("Invalid new chat ID")}}catch(e){console.error("Error details:",((u=e.response)==null?void 0:u.data)||e),h.value={show:!0,text:"Ошибка при создании чата",color:"error"}}};return j(L),(u,e)=>(d(),f(q,{class:"py-10"},{default:a(()=>[l(b,{justify:"center"},{default:a(()=>[l(g,{cols:"12",md:"10",lg:"8"},{default:a(()=>[l(w,{class:"profile-card mb-8",elevation:"8"},{default:a(()=>[l(b,{"no-gutters":"",align:"center"},{default:a(()=>[l(g,{cols:"auto",class:"d-flex flex-column align-center px-8 py-8 profile-avatar-col"},{default:a(()=>[l(Y,{size:"110",color:"primary",class:"mb-4 elevation-6"},{default:a(()=>{var t,o,r;return[s("span",le,n(((r=(o=(t=i.value)==null?void 0:t.user)==null?void 0:o.name)==null?void 0:r.charAt(0))||"?"),1)]}),_:1}),l(z,{color:"primary",class:"mt-2","prepend-icon":"mdi-account-badge"},{default:a(()=>e[5]||(e[5]=[c("Исполнитель")])),_:1})]),_:1}),l(g,null,{default:a(()=>[l(S,{class:"text-h4 font-weight-bold mb-2"},{default:a(()=>{var t,o,r,p,I,$;return[c(n((o=(t=i.value)==null?void 0:t.user)==null?void 0:o.surname)+" "+n((p=(r=i.value)==null?void 0:r.user)==null?void 0:p.name)+" "+n(($=(I=i.value)==null?void 0:I.user)==null?void 0:$.patronymic),1)]}),_:1}),l(A,{class:"mb-2"},{default:a(()=>{var t,o;return[l(_,{size:"20",color:"grey-darken-1",class:"mr-1"},{default:a(()=>e[6]||(e[6]=[c("mdi-email")])),_:1}),s("span",se,n((o=(t=i.value)==null?void 0:t.user)==null?void 0:o.email),1)]}),_:1}),l(B,{class:"text-body-1 mt-2"},{default:a(()=>{var t;return[c(n(((t=i.value)==null?void 0:t.description)||"Нет описания"),1)]}),_:1}),l(G,null,{default:a(()=>[l(D,{color:m.value?"primary":"success","prepend-icon":m.value?"mdi-chat":"mdi-chat-plus",onClick:P},{default:a(()=>[c(n(m.value?"Открыть чат":"Начать чат"),1)]),_:1},8,["color","prepend-icon"])]),_:1})]),_:1})]),_:1})]),_:1}),l(w,{class:"mb-8 pa-6",elevation:"4"},{default:a(()=>{var t,o;return[s("div",oe,[l(_,{color:"indigo",class:"mr-2"},{default:a(()=>e[7]||(e[7]=[c("mdi-github")])),_:1}),e[8]||(e[8]=s("h3",{class:"text-h5 font-weight-bold mb-0"},"Проекты",-1))]),(o=(t=i.value)==null?void 0:t.projects)!=null&&o.length?(d(),f(b,{key:0,class:"project-list"},{default:a(()=>[(d(!0),v(C,null,x(i.value.projects,r=>(d(),f(g,{key:r.id,cols:"12",md:"6"},{default:a(()=>[l(w,{class:"mb-4 project-card",elevation:"2",onClick:p=>O(r.id),style:{cursor:"pointer"}},{default:a(()=>[l(S,{class:"font-weight-bold text-primary"},{default:a(()=>[c(n(r.name),1)]),_:2},1024),l(A,null,{default:a(()=>[l(_,{size:"18",color:"grey-darken-1",class:"mr-1"},{default:a(()=>e[9]||(e[9]=[c("mdi-link-variant")])),_:1}),s("a",{href:r.repository,target:"_blank",onClick:e[0]||(e[0]=R(()=>{},["stop"]))},n(r.repository),9,re)]),_:2},1024),l(B,null,{default:a(()=>[c(n(r.text),1)]),_:2},1024),r.photos&&r.photos.length?(d(),f(b,{key:0,class:"mt-2"},{default:a(()=>[l(g,{cols:"12"},{default:a(()=>[l(X,{"hide-delimiter-background":"","show-arrows":"hover",height:"200",onClick:e[1]||(e[1]=R(()=>{},["stop"]))},{default:a(()=>[(d(!0),v(C,null,x(r.photos,p=>(d(),f(Z,{key:p.id,src:p.link,cover:""},null,8,["src"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)):ee("",!0)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})):(d(),v("div",ne,"Нет проектов"))]}),_:1}),l(w,{class:"mb-8 pa-6",elevation:"4"},{default:a(()=>{var t,o;return[s("div",ie,[l(_,{color:"teal-darken-2",class:"mr-2"},{default:a(()=>e[10]||(e[10]=[c("mdi-briefcase-outline")])),_:1}),e[11]||(e[11]=s("h3",{class:"text-h5 font-weight-bold mb-0"},"Заказы",-1))]),(o=(t=i.value)==null?void 0:t.orders)!=null&&o.length?(d(),f(ae,{key:0,class:"orders-table"},{default:a(()=>[e[12]||(e[12]=s("thead",null,[s("tr",null,[s("th",null,"Название"),s("th",null,"Статус"),s("th",null,"Цена"),s("th",null,"Срок"),s("th",null,"Статус участия")])],-1)),s("tbody",null,[(d(!0),v(C,null,x(i.value.orders,r=>(d(),v("tr",{key:r.id,onClick:p=>H(r.id),style:{cursor:"pointer"}},[s("td",null,n(r.title),1),s("td",null,[l(z,{color:r.status==="Завершен"?"success":r.status==="В работе"?"primary":"grey",size:"small"},{default:a(()=>[c(n(r.status),1)]),_:2},1032,["color"])]),s("td",null,n(r.price),1),s("td",null,n(r.time),1),s("td",null,n(r.order_contractor_status),1)],8,ue))),128))])]),_:1})):(d(),v("div",de,"Нет заказов"))]}),_:1}),l(w,{class:"pa-6",elevation:"4"},{default:a(()=>[s("div",ce,[s("div",me,[l(_,{color:"amber-darken-2",class:"mr-2"},{default:a(()=>e[13]||(e[13]=[c("mdi-star-outline")])),_:1}),e[14]||(e[14]=s("h3",{class:"text-h5 font-weight-bold mb-0"},"Отзывы",-1))]),l(J,{modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=t=>V.value=t),items:F,label:"Сортировка",density:"compact",variant:"outlined",class:"feedback-sort","hide-details":""},null,8,["modelValue"])]),T.value.length?(d(),f(b,{key:0},{default:a(()=>[(d(!0),v(C,null,x(T.value,t=>(d(),f(g,{key:t.id,cols:"12"},{default:a(()=>[l(te,{type:t.estimation>=4?"success":t.estimation>=3?"warning":"error",class:"mb-2"},{default:a(()=>[s("div",fe,[l(_,{left:"",size:"18",color:"amber"},{default:a(()=>e[15]||(e[15]=[c("mdi-star")])),_:1}),c(" Оценка: "+n(t.estimation),1)]),s("div",null,n(t.text),1),s("div",ve,n(t.timestamp),1)]),_:2},1032,["type"])]),_:2},1024))),128))]),_:1})):(d(),v("div",he,"Нет отзывов"))]),_:1})]),_:1})]),_:1}),l(K,{modelValue:h.value.show,"onUpdate:modelValue":e[4]||(e[4]=t=>h.value.show=t),color:h.value.color,timeout:3e3},{actions:a(()=>[l(D,{variant:"text",onClick:e[3]||(e[3]=t=>h.value.show=!1)},{default:a(()=>e[16]||(e[16]=[c("Закрыть")])),_:1})]),default:a(()=>[c(n(h.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1}))}},be=M(pe,[["__scopeId","data-v-e70202c1"]]);export{be as default};
