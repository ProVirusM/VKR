import{_ as I,r as p,b as L,d as y,e as f,f as s,m as O,J as F,u as P,o as l,h as S,g as t,a,t as c,v as w,p as o,n as q,i as E,V as $,K as B,x as J,c as x,k as K,F as A,q as M,A as k,l as R,z as G,L as H}from"./index-DxBUXSDN.js";const Q={class:"text-h5 font-weight-bold"},U={class:"mb-3 text-body-1"},W={class:"mb-3"},X={class:"mt-2 d-flex flex-wrap gap-2"},Y={key:1,class:"text-center mt-10"},Z={__name:"OrderDetails",setup(ee){const v=F(),m=P(),n=p(null),_=p([]),g=p(null),T=p(!0),z=p(null),d=p("");L(()=>{if(d.value=localStorage.getItem("token")||"",!d.value){m.push("/login");return}D()});const D=async()=>{var u,e,r,V,b;try{const i=v.params.id,[C,j]=await Promise.all([y.get(`/api/orders/${i}/full`,{headers:{Authorization:`Bearer ${d.value}`}}),y.get("/api/profile",{headers:{Authorization:`Bearer ${d.value}`}})]);n.value=((u=C.data)==null?void 0:u.order)||null,_.value=((e=C.data)==null?void 0:e.stacks)||[],g.value=j.data||null}catch(i){z.value=((V=(r=i.response)==null?void 0:r.data)==null?void 0:V.message)||i.message,console.error("Ошибка:",i),((b=i.response)==null?void 0:b.status)===401&&m.push("/login")}finally{T.value=!1}},h=async()=>{var u,e;try{if(!d.value){m.push("/login");return}(await y.post(`/api/orders/${v.params.id}/respond`,{},{headers:{Authorization:`Bearer ${d.value}`,"Content-Type":"application/json"}})).status===200&&(alert("Отклик успешно отправлен!"),m.push(`/customer/orders/${v.params.id}/responders`))}catch(r){console.error("Ошибка при отклике:",r),alert(((e=(u=r.response)==null?void 0:u.data)==null?void 0:e.message)||"Ошибка при отправке отклика")}},N=()=>{m.push(`/customer/orders/${v.params.id}/responders`)};return(u,e)=>(l(),f(O,{class:"py-10"},{default:s(()=>[n.value?(l(),f(S,{key:0,class:"mx-auto pa-6","max-width":"800",elevation:"10",rounded:"2xl"},{default:s(()=>[t(q,{class:"d-flex justify-space-between align-center"},{default:s(()=>[a("span",Q,c(n.value.ord_title),1),t(w,{color:"blue lighten-2","text-color":"white"},{default:s(()=>[o(c(n.value.ord_status),1)]),_:1})]),_:1}),t(M,null,{default:s(()=>[a("p",U,[e[1]||(e[1]=a("strong",null,"Описание:",-1)),e[2]||(e[2]=a("br",null,null,-1)),o(" "+c(n.value.ord_text),1)]),t(E,{class:"mb-4"},{default:s(()=>[t($,{cols:"12",sm:"6"},{default:s(()=>[t(B,{class:"mr-1",color:"green"},{default:s(()=>e[3]||(e[3]=[o("mdi-currency-rub")])),_:1}),e[4]||(e[4]=a("strong",null,"Цена:",-1)),o(" "+c(n.value.ord_price)+" ₽ ",1)]),_:1}),t($,{cols:"12",sm:"6"},{default:s(()=>[t(B,{class:"mr-1",color:"orange"},{default:s(()=>e[5]||(e[5]=[o("mdi-clock-outline")])),_:1}),e[6]||(e[6]=a("strong",null,"Срок:",-1)),o(" "+c(n.value.ord_time),1)]),_:1})]),_:1}),t(J,{class:"my-4"}),a("div",W,[e[7]||(e[7]=a("strong",null,"Технологии:",-1)),a("div",X,[(l(!0),x(A,null,K(_.value,r=>(l(),f(w,{key:r.id,color:"deep-purple accent-4","text-color":"white",class:"ma-1",label:"",pill:""},{default:s(()=>[o(c(r.title),1)]),_:2},1024))),128))])])]),_:1}),t(G,{class:"d-flex justify-space-between"},{default:s(()=>[t(k,{color:"grey",variant:"outlined",onClick:e[0]||(e[0]=r=>u.$router.back())},{default:s(()=>e[8]||(e[8]=[o("Назад")])),_:1}),Array.isArray(g.value.roles)?(l(),x(A,{key:0},[g.value.roles.includes("customer")?(l(),f(k,{key:0,color:"primary",onClick:N},{default:s(()=>e[9]||(e[9]=[o(" Откликнувшиеся ")])),_:1})):g.value.roles.includes("contractor")?(l(),f(k,{key:1,color:"success",onClick:h},{default:s(()=>e[10]||(e[10]=[o(" Откликнуться ")])),_:1})):R("",!0)],64)):R("",!0)]),_:1})]),_:1})):(l(),x("div",Y,[t(H,{indeterminate:"",color:"primary",size:"50"}),e[11]||(e[11]=a("p",{class:"mt-3"},"Загрузка заказа...",-1))]))]),_:1}))}},te=I(Z,[["__scopeId","data-v-b5535506"]]);export{te as default};
