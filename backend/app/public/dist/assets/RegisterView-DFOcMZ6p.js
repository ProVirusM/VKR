import{G as M,H as E,I as B,J as D,K as P,g as l,L as C,M as J,N as L,O as j,P as N,Q as H,R as K,S as Q,T as W,U as G,F as X,W as Y,X as Z,r as u,o as S,e as k,f as s,n as z,p as i,C as _,D as h,E as I,a as w,Y as q,Z as ee,l as A,$ as ae,t as O,A as T,h as le,m as oe,u as te,d as $}from"./index-BAPhhIwE.js";const se=M({...E({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"VRadio"),F=B()({name:"VRadio",props:se(),setup(o,m){let{slots:c}=m;return D(()=>{const r=P.filterProps(o);return l(P,C(r,{class:["v-radio",o.class],style:o.style,type:"radio"}),c)}),{}}}),re=M({height:{type:[Number,String],default:"auto"},...J(),...L(j(),["multiple"]),trueIcon:{type:N,default:"$radioOn"},falseIcon:{type:N,default:"$radioOff"},type:{type:String,default:"radio"}},"VRadioGroup"),ue=B()({name:"VRadioGroup",inheritAttrs:!1,props:re(),emits:{"update:modelValue":o=>!0},setup(o,m){let{attrs:c,slots:r}=m;const g=H(),p=K(()=>o.id||`radio-group-${g}`),n=Q(o,"modelValue");return D(()=>{const[d,v]=W(c),V=G.filterProps(o),R=P.filterProps(o),b=r.label?r.label({label:o.label,props:{for:p.value}}):o.label;return l(G,C({class:["v-radio-group",o.class],style:o.style},d,V,{modelValue:n.value,"onUpdate:modelValue":f=>n.value=f,id:p.value}),{...r,default:f=>{let{id:e,messagesId:a,isDisabled:x,isReadonly:t}=f;return l(X,null,[b&&l(Y,{id:e.value},{default:()=>[b]}),l(Z,C(R,{id:e.value,"aria-describedby":a.value,defaultsTarget:"VRadio",trueIcon:o.trueIcon,falseIcon:o.falseIcon,type:o.type,disabled:x.value,readonly:t.value,"aria-labelledby":b?e.value:void 0,multiple:!1},v,{modelValue:n.value,"onUpdate:modelValue":y=>n.value=y}),r)])}})}),{}}}),ne={class:"d-flex align-center"},de={class:"d-flex align-center"},me={__name:"RegisterView",setup(o){const m=u(""),c=u(""),r=u(""),g=u(""),p=u(""),n=u(""),d=u(""),v=u(!1),V=u("customer"),R=te(),b=async()=>{var f,e,a,x;d.value="",v.value=!0;try{console.log("Начало регистрации");const t=await $.post("/api/register",{usr_name:m.value,usr_surname:c.value,usr_patronymic:r.value,email:g.value,password:p.value,role:V.value,description:V.value==="contractor"?n.value:void 0});console.log("Регистрация успешна:",t.data),console.log("Попытка входа");const y=await $.post("/api/login_check",{email:g.value,password:p.value});console.log("Вход успешен:",y.data);const U=y.data.token;console.log("Токен получен:",U),localStorage.setItem("token",U),localStorage.setItem("name",t.data.user.name),localStorage.setItem("surname",t.data.user.surname),localStorage.setItem("email",t.data.user.email),localStorage.setItem("roles",JSON.stringify(t.data.user.roles)),console.log("Перенаправление на /dashboard"),await R.push("/dashboard")}catch(t){if(console.error("Ошибка:",t),(e=(f=t.response)==null?void 0:f.data)!=null&&e.message)d.value=t.response.data.message;else if((x=(a=t.response)==null?void 0:a.data)!=null&&x.error){const y={"User with this email already exists":"Пользователь с таким email уже существует","Missing required fields":"Не все обязательные поля заполнены"};d.value=y[t.response.data.error]||t.response.data.error}else d.value="Произошла ошибка при регистрации"}finally{v.value=!1}};return(f,e)=>(S(),k(oe,{class:"d-flex align-center justify-center fill-height"},{default:s(()=>[l(le,{class:"pa-6","max-width":"400",elevation:"12"},{default:s(()=>[l(z,{class:"text-h5 text-center mb-4"},{default:s(()=>e[7]||(e[7]=[i("Регистрация")])),_:1}),l(_,{onSubmit:h(b,["prevent"])},{default:s(()=>[l(I,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=a=>m.value=a),label:"Имя",required:""},null,8,["modelValue"]),l(I,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=a=>c.value=a),label:"Фамилия",required:""},null,8,["modelValue"]),l(I,{modelValue:r.value,"onUpdate:modelValue":e[2]||(e[2]=a=>r.value=a),label:"Отчество",required:""},null,8,["modelValue"]),l(I,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=a=>g.value=a),label:"Email",type:"email",required:""},null,8,["modelValue"]),l(I,{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=a=>p.value=a),label:"Пароль",type:"password",required:""},null,8,["modelValue"]),l(ue,{modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=a=>V.value=a),class:"mt-4"},{label:s(()=>e[8]||(e[8]=[w("div",{class:"text-subtitle-1 font-weight-bold"},"Выберите роль:",-1)])),default:s(()=>[l(F,{value:"customer",color:"primary"},{label:s(()=>[w("div",ne,[l(q,{color:"primary",class:"mr-2"},{default:s(()=>e[9]||(e[9]=[i("mdi-account")])),_:1}),e[10]||(e[10]=i(" Заказчик "))])]),_:1}),l(F,{value:"contractor",color:"primary"},{label:s(()=>[w("div",de,[l(q,{color:"primary",class:"mr-2"},{default:s(()=>e[11]||(e[11]=[i("mdi-briefcase")])),_:1}),e[12]||(e[12]=i(" Исполнитель "))])]),_:1})]),_:1},8,["modelValue"]),V.value==="contractor"?(S(),k(ee,{key:0,modelValue:n.value,"onUpdate:modelValue":e[6]||(e[6]=a=>n.value=a),label:"Опишите себя и свой опыт",rows:"4","auto-grow":"",class:"mt-4",rules:[a=>!a||a.length<=1e3||"Описание не должно превышать 1000 символов"],counter:""},null,8,["modelValue","rules"])):A("",!0),d.value?(S(),k(ae,{key:1,type:"error",class:"mt-3"},{default:s(()=>[i(O(d.value),1)]),_:1})):A("",!0),l(T,{type:"submit",color:"success",class:"mt-4",block:"",loading:v.value,disabled:v.value},{default:s(()=>[i(O(v.value?"Регистрация...":"Зарегистрироваться"),1)]),_:1},8,["loading","disabled"]),l(T,{variant:"text",class:"mt-2",block:"",to:"/login"},{default:s(()=>e[13]||(e[13]=[i("Уже есть аккаунт?")])),_:1})]),_:1})]),_:1})]),_:1}))}};export{me as default};
