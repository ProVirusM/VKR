import{r as s,o as y,e as w,f as t,g as l,n as U,p,C as _,D as N,E as n,G as R,t as x,l as B,A as k,h as I,m as T,u as A,d as C}from"./index-B4YrDoW6.js";const F={__name:"RegisterView",setup(D){const v=s(""),c=s(""),V=s(""),d=s(""),i=s(""),r=s(""),u=s(!1),S=A(),q=async()=>{var g,e,a,f;r.value="",u.value=!0;try{console.log("Начало регистрации");const o=await C.post("/api/register",{usr_name:v.value,usr_surname:c.value,usr_patronymic:V.value,email:d.value,password:i.value,role:"customer"});console.log("Регистрация успешна:",o.data),console.log("Попытка входа");const m=await C.post("/api/login_check",{email:d.value,password:i.value});console.log("Вход успешен:",m.data);const b=m.data.token;console.log("Токен получен:",b),localStorage.setItem("token",b),localStorage.setItem("name",m.data.name),localStorage.setItem("email",m.data.email),console.log("Перенаправление на /dashboard"),await S.push("/dashboard")}catch(o){console.error("Ошибка:",o),(e=(g=o.response)==null?void 0:g.data)!=null&&e.message?r.value=o.response.data.message:(f=(a=o.response)==null?void 0:a.data)!=null&&f.error?r.value=o.response.data.error:r.value="Произошла ошибка при регистрации"}finally{u.value=!1}};return(g,e)=>(y(),w(T,{class:"d-flex align-center justify-center fill-height"},{default:t(()=>[l(I,{class:"pa-6","max-width":"400",elevation:"12"},{default:t(()=>[l(U,{class:"text-h5 text-center mb-4"},{default:t(()=>e[5]||(e[5]=[p("Регистрация")])),_:1}),l(_,{onSubmit:N(q,["prevent"])},{default:t(()=>[l(n,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=a=>v.value=a),label:"Имя",required:""},null,8,["modelValue"]),l(n,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=a=>c.value=a),label:"Фамилия",required:""},null,8,["modelValue"]),l(n,{modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=a=>V.value=a),label:"Отчество",required:""},null,8,["modelValue"]),l(n,{modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=a=>d.value=a),label:"Email",type:"email",required:""},null,8,["modelValue"]),l(n,{modelValue:i.value,"onUpdate:modelValue":e[4]||(e[4]=a=>i.value=a),label:"Пароль",type:"password",required:""},null,8,["modelValue"]),r.value?(y(),w(R,{key:0,type:"error",class:"mt-3"},{default:t(()=>[p(x(r.value),1)]),_:1})):B("",!0),l(k,{type:"submit",color:"success",class:"mt-4",block:"",loading:u.value,disabled:u.value},{default:t(()=>[p(x(u.value?"Регистрация...":"Зарегистрироваться"),1)]),_:1},8,["loading","disabled"]),l(k,{variant:"text",class:"mt-2",block:"",to:"/login"},{default:t(()=>e[6]||(e[6]=[p("Уже есть аккаунт?")])),_:1})]),_:1})]),_:1})]),_:1}))}};export{F as default};
